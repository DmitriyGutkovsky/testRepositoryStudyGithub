-- Homework SQL

-- TASK 1: Вывести все уникальные имена ролей пользователей.
select distinct role_name
from m_roles;


-- TASK 2: Подсчитать число машин у каждого пользователя.
-- Вывести в формате
-- User full name (username + пробел + user surname) | Число машин у пользователя.

-- 1-ый вариант вывода: результат таблицей
select username, surname, count(m_cars.id)
from m_users
         join m_cars
              on m_users.id = m_cars.user_id
GROUP BY m_users.id
order by m_users.id;

-- 2-ой вариант вывода: вывод одной колонкой (параметры перечислены в строку через ', '): User1, Surname1, 1
select username || ', ' || surname || ', ' || count(m_cars.id)
from m_users
         join m_cars
              on m_users.id = m_cars.user_id
GROUP BY m_users.id
order by m_users.id;

-- 3-ий вариант вывода: двумя столбаци: первый столбец "User1, Surname1", второй - число машин у пользователя
select username || ', ' || surname, count(m_cars.id)
from m_users
         join m_cars
              on m_users.id = m_cars.user_id
GROUP BY m_users.id
order by m_users.id;


-- TASK 3: Подсчитать для каждого диллера число машин, старше 2018 года производства с красным кузовом.
-- в таблицу m_cars добавил колонки: creation_year (год выпуска) и country_of_origin (страна происхождения)

select d.name as dealer_name, count(mc.id)
from m_auto_dealer as d join m_cars mc on d.id = mc.dealer_id
join m_body mb on mc.id = mb.car_id
where mc.creation_year < 2018 and mb.color = 'red'
group by d.name;